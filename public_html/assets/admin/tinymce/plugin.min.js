/*
 *	tiny-bs-grid https://github.com/jeffhehe/tiny-bs-grid
 *  this works for TinyMCE5.* on Bootstrap 4.*
 *  Version: v0.3v
 *  Author: Jeff Wang
 *  Date: April 24, 2019
 */
tinymce.PluginManager.add("bootstrap4grid",function(g,e){g.contentCSS.push(e+"/bootstrapgrid-style.css"),g.ui.registry.addToggleButton("bootstrap4grid",{text:"BS4 Grid",tooltip:"Bootstrap4 Grid System",onAction:function(){var e="Insert Bootstrap4 Grids",t="12",a="-md",s=g.selection.getNode(),n=jQuery(s).parents("div.row"),c=0<n.length;if(c){var l=n[0],o=jQuery(l).children("div"),p=o.length,d=[];if(0<p)for(t="",i=0;i<p;i++){var r=jQuery(o[i]).attr("class").split(/\s+/),u=jQuery(o[i]).html();for(d.push(u),j=0;j<r.length;j++)if(/^col-.*/i.test(r[j])){0==j&&(a=-1<r[0].indexOf("col-xl")?"-xl":-1<r[0].indexOf("col-lg")?"-lg":-1<r[0].indexOf("col-md")?"-md":-1<r[0].indexOf("col-sm")?"-sm":"");var v=r[j].lastIndexOf("-"),m=r[j].substr(v+1);t+=m}}e="Update/Remove Bootstrap4 Grids"}var b=[{type:"selectbox",name:"size",label:"Target Screen",items:[{text:"X Large >= 1200px",value:"-xl"},{text:"Large >= 992px",value:"-lg"},{text:"Medium >= 768px",value:"-md"},{text:"Small >= 576px",value:"-sm"},{text:"X Small < 576px",value:""}]},{type:"selectbox",name:"grid",label:"Grid",items:[{text:"1 Column",value:"12"},{text:"2 Columns (1:1)",value:"66"},{text:"2 Columns (2:1)",value:"84"},{text:"2 Columns (3:1)",value:"93"},{text:"2 Columns (1:2)",value:"48"},{text:"2 Columns (1:3)",value:"39"},{text:"3 Columns (1:1:1)",value:"444"},{text:"3 Columns (2:1:1)",value:"633"},{text:"3 Columns (1:2:1)",value:"363"},{text:"3 Columns (1:1:2)",value:"336"},{text:"4 Columns (1:1:1:1)",value:"3333"}]},{type:"checkbox",name:"leadingBreak",label:"Add a Leading Line Break"}],x={type:"panel",items:b};c&&(x={type:"tabpanel",tabs:[{title:"Update Bootstrap Grids",items:b},{title:"Remove Bootstrap Grids",items:[{type:"checkbox",name:"removeGrids",label:"Remove Bootstrap Grids"}]}]}),g.windowManager.open({title:e,body:x,initialData:{size:a,grid:t},buttons:[{type:"submit",name:"submitBtn",text:"Submit"},{type:"cancel",name:"cancelBtn",text:"Cancel"}],onSubmit:function(e){var l=e.getData(),t="",o="",r="<p>&nbsp;</p>";if(1==l.leadingBreak&&(t="<p>&nbsp;</p>"),1==l.removeGrids&&c)return o=d.join("<p>&nbsp;</p>"),jQuery(n).replaceWith(t+o+r),void e.close();var a=function(e,t){if(c){if(0<p&&p<e){for(var a=0;a<p;a++)o+='<div class="col'+l.size+"-"+t[a]+'">'+d.shift()+"</div>";for(var s=p;s<e;s++)o+='<div class="col'+l.size+"-"+t[s]+'"><p>&nbsp;</p></div>'}else if(e<=p){for(var a=0;a<e;a++)o+='<div class="col'+l.size+"-"+t[a]+'">'+d.shift()+"</div>";e<p&&(r="<p>&nbsp;</p>"+d.join("<p>&nbsp;</p>")+"<p>&nbsp;</p>")}}else for(var i=0;i<e;i++)o+='<div class="col'+l.size+"-"+t[i]+'"><p>&nbsp;</p></div>'};switch(l.grid){case"12":a(1,[12]);break;case"66":a(2,[6,6]);break;case"84":a(2,[8,4]);break;case"93":a(2,[9,3]);break;case"48":a(2,[4,8]);break;case"39":a(2,[3,9]);break;case"444":a(3,[4,4,4]);break;case"633":a(3,[6,3,3]);break;case"363":a(3,[3,6,3]);break;case"336":a(3,[3,3,6]);break;case"3333":a(4,[3,3,3,3])}c?jQuery(n).replaceWith(t+'<div class="row">'+o+"</div>"+r):g.insertContent(t+'<div class="row">'+o+"</div>"+r),e.close()}})},onSetup:function(t){g.selection.selectorChanged("div.row",function(e){t.setActive(e)})}})});